package jenkins.base_jobs

import groovy.json.JsonSlurper

def hi = load ("base_jobs/helm_installer.groovy")

stage('Parallel Helm Install') {
    def jobs = [:]
    dep_ids = groovy.json.JsonOutput.toJson(DEPLOYMENT_ID.split(","))

    for (int i = 0; i < dep_ids.size(); ++i) {
        def dep = dep_ids[i].trim()
        jobs[dep] = {
            node(dep) {
                hi.helm_install(dep)
            }
        }
    }

    parallel(jobs)
}