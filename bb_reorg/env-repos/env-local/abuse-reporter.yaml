apiVersion: v1
kind: Service
metadata:
  name: abuse-reporter
  labels:
    component: abuse-reporter
    tier: abuse-reporter
spec:
  type: NodePort
  ports:
    - port: 8080
      targetPort: 8080
      name: http-rest
  selector:
    component: abuse-reporter
    tier: abuse-reporter
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: abuse-reporter-deployment
  labels:
    component: abuse-reporter
    tier: abuse-reporter
spec:
  selector:
    matchLabels:
      component: abuse-reporter
  replicas: 1
  template:
    metadata:
      labels:
        component: abuse-reporter
        tier: abuse-reporter
    spec:
      containers:
        - name: abuse-reporter
          image: 407733091588.dkr.ecr.us-west-2.amazonaws.com/ego-server/abuse-reporter:1.0.27
          command:
            - "/bin/bash"
            - "-c"
            - "./start.sh -Xms640m -Xmx640m -Dspring.profiles.active=local -Dlogging.level.com.withme.abusereporter=DEBUG"
          env:
            - name: TRANSIENT_CHAT_FILTER_APP_ID
              value: "f4627bee-5b9d-4bc8-8a52-711a133b5d5d"
            - name: USERNAME_ABUSE_REPORT_APP_ID
              value: "1bd74536-20b0-4c57-bfb2-4175b3d08680"
            - name: USER_BIO_ABUSE_REPORT_APP_ID
              value: "5bc229a6-83ec-49ff-ab75-e632fa48b8cd"
            - name: ITEM_MODERATION_API_KEY
              value: "Sfzjx0Yw9tSV4Er9AhQAvA_bEHgPm1uh28dgekWuS-w"
            - name: INTERNAL_API_KEY
              value: "Sfzjx0Yw9tSV4Er9AhQAvA_bEHgPm1uh28dgekWuS-w"
          livenessProbe:
            httpGet:
              path: /health/v1/lively
              port: 8080
            initialDelaySeconds: 40
            periodSeconds: 15
            failureThreshold: 10
          readinessProbe:
            httpGet:
              path: /health/v1/ready
              port: 8080
            initialDelaySeconds: 40
            periodSeconds: 15
            failureThreshold: 2
          ports:
            - containerPort: 8080